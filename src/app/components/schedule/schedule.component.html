<section class="sched">
  <h2>Um√≥w wizytƒô</h2>

  <form [formGroup]="form" (ngSubmit)="submit()" class="form">
    <!-- US≈ÅUGA -->
    <div class="row">
      <label>Us≈Çuga</label>
      <select [formControl]="form.controls.service">
        <option [ngValue]="null" disabled>Wybierz us≈Çugƒô‚Ä¶</option>

        @for (cat of categories; track cat) {
          <optgroup [label]="cat">
            @for (s of byCategory(cat); track s.name) {
              <option [ngValue]="s">{{ s.name }}</option>
            }
          </optgroup>
        }
      </select>
      @if (hasErr('service','required')) { <small class="err">Wybierz us≈Çugƒô</small> }
    </div>

    <!-- Nazwa us≈Çugi jako tekst (auto-uzupe≈Çniane, mo≈ºna doprecyzowaƒá) -->
    <!-- <div class="row">
      <label>Nazwa us≈Çugi (mo≈ºesz doprecyzowaƒá)</label>
      <input type="text" formControlName="serviceText" placeholder="Np. Manicure hybrydowy + zdobienia" />
      @if (hasErr('serviceText','required')) { <small class="err">To pole jest wymagane</small> }
    </div> -->

    <!-- META wybranej us≈Çugi -->
    @let svc = form.controls.service.value;
    @if (svc) {
      <div class="service-meta">
        @if (svc.description) { <div><span class="desc">{{ svc.description }}</span></div> }
        <span class="chip">‚è± {{ svc.time }} min </span>
        <span class="chip">üí∏ {{ svc.price }} z≈Ç</span>
        
      </div>
    }

    <!-- CZAS TRWANIA + DATA -->
    <div class="grid">
      <div class="row">
        <label>Data</label>
        <input type="date" formControlName="date" />
        @if (hasErr('date','required')) { <small class="err">Podaj datƒô</small> }
      </div>
    </div>

    <!-- DOSTƒòPNE GODZINY (kafelki) -->
    @if (form.get('date')?.value) {
      <div class="row">
        <label>Dostƒôpne godziny</label>
        <div class="slots">
          @for (t of availableSlots(); track t) {
            <button
              type="button"
              class="slot"
              [class.selected]="form.value.time === t"
              (click)="pickSlot(t)">
              {{ t }}
            </button>
          }
          @if (!availableSlots().length) {
            <div class="no-slots">Brak wolnych termin√≥w w tym dniu.</div>
          }
        </div>
      </div>
    }

    <!-- DANE KLIENTA -->
    <div class="row">
      <label>Imiƒô i nazwisko</label>
      <input type="text" formControlName="name" placeholder="Np. Anna Kowalska" />
      @if (hasErr('name','required')) { <small class="err">To pole jest wymagane</small> }
      @if (hasErr('name','minlength')) { <small class="err">Min. 2 znaki</small> }
    </div>

    <div class="row">
      <label>Uwagi (opcjonalnie)</label>
      <textarea rows="3" formControlName="notes" placeholder="Dodatkowe informacje‚Ä¶"></textarea>
    </div>

    <!-- AKCJA -->
    <button class="btn" type="submit" [disabled]="submitting || form.invalid || !form.value.time">
      @if (!submitting) { Zarezerwuj termin } @else { Zapisywanie‚Ä¶ }
    </button>

    @if (successMsg) { <div class="alert success">{{ successMsg }}</div> }
    @if (errorMsg) { <div class="alert error">{{ errorMsg }}</div> }
  </form>

  <!-- PODGLƒÑD DNIA -->
  @if (todays.length) {
    <div class="preview">
      <h3>Rezerwacje w dniu {{ form.get('date')?.value }}</h3>
      <ul>
        @for (a of todays; track a.id) {
          <li>
            <strong>{{ a.time }}</strong> ‚Äî {{ a.serviceText }} ({{ a.name }}) ¬∑ {{ a.duration }} min
          </li>
        }
      </ul>
    </div>
  }
</section>
